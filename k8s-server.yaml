---
- hosts: master
  become: yes
  tasks:
  - name: Setup K8S cluster
    shell: |
      kubeadm init --pod-network-cidr=192.168.56.101/24
      exit 0
    register: output
  - debug: var=output.stdout_lines

  - name: Save kubeadm output
    shell: echo "{{ output.stdout_lines }}" >> "{{ logname_home.stdout }}/.kube/init.log"
  - name: Setup K8S config
    shell: |
      cp -i /etc/kubernetes/admin.conf "{{ logname_home.stdout }}"/.kube/config;
      chown -R $SUDO_USER:$SUDO_USER "{{ logname_home.stdout }}/.kube";
      exit 0